<!DOCTYPE html>

<html>
<head>
  <title>mruby_main.c</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="mruby_main.html">
                  mruby_main.c
                </a>
              
                
                <a class="source" href="mruby_script.html">
                  mruby_script.rb
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>mruby_main.c</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>c headers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;stdlib.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;stdio.h&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>include mruby header files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/compile.h&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>mruby additional headers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/string.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/numeric.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/array.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/class.h&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;mruby/variable.h&gt;</span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>initialize mruby</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_state *mrb = mrb_open();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>load ruby script</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  FILE *file = fopen(<span class="hljs-string">"mruby_script.rb"</span>, <span class="hljs-string">"r"</span>);
  mrb_load_file(mrb, file);
  fclose(file);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>invoke method from ruby script,
donâ€™t pass any arguments to method,
ignore return value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_funcall(mrb, mrb_top_self(mrb), <span class="hljs-string">"invoke_me"</span>, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3 id="nil-value">nil value</h3>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>create ruby nil value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_nil = mrb_nil_value();</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>pass nil value to method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value return_ruby_nil = mrb_funcall(mrb, mrb_top_self(mrb), <span class="hljs-string">"one_arg_method"</span>, <span class="hljs-number">1</span>, ruby_nil);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>check if return value is nill</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (mrb_nil_p(return_ruby_nil)) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"return_ruby_nil is nil!\n"</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3 id="string-manipulation">string manipulation</h3>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>create string value form c string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_string = mrb_str_new_cstr(mrb, <span class="hljs-string">"some string"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>pass string to method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value return_ruby_string = mrb_funcall(mrb, mrb_top_self(mrb), <span class="hljs-string">"one_arg_method"</span>, <span class="hljs-number">1</span>, ruby_string);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>convert ruby string value to c string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *return_c_string = RSTRING_PTR(return_ruby_string);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>print string value from c</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"retrun_c_string: %s\n"</span>, return_c_string);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3 id="fixnum-manipulation">fixnum manipulation</h3>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>create fixnum value from c int</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_fixnum = mrb_fixnum_value(<span class="hljs-number">7</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>pass fixnum value to method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value return_ruby_fixnum = mrb_funcall(mrb, mrb_top_self(mrb), <span class="hljs-string">"one_arg_method"</span>, <span class="hljs-number">1</span>, ruby_fixnum);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>convert fixnum to int</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">int</span> return_c_int = mrb_fixnum(return_ruby_fixnum);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>print fixnum value from c</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"retrun_c_fixnum: %d\n"</span>, return_c_int);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3 id="float-manipulation">float manipulation</h3>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>create float value from c float</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_float = mrb_float_value(mrb, <span class="hljs-number">3.14</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>pass float to method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value return_ruby_float = mrb_funcall(mrb, mrb_top_self(mrb), <span class="hljs-string">"one_arg_method"</span>, <span class="hljs-number">1</span>, ruby_float);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>convert ruby float value to c float</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">float</span> return_c_float = mrb_float(return_ruby_float);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>print float value from c</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"retrun_c_string: %g\n"</span>, return_c_float);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="methods">methods</h3>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>check if not_existing_method exists ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(mrb_respond_to(mrb, mrb_top_self(mrb), mrb_intern_lit(mrb, <span class="hljs-string">"not_existing_method"</span>))){
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"not_existing_method exist!\n"</span>);
  }<span class="hljs-keyword">else</span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"not_existing_method not exist\n"</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>check if invoke_me method exists ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(mrb_respond_to(mrb, mrb_top_self(mrb), mrb_intern_lit(mrb, <span class="hljs-string">"invoke_me"</span>))){
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"invoke_me method exist\n"</span>);
  }<span class="hljs-keyword">else</span>{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"invike_me method not exist!\n"</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="classes">classes</h3>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>get ruby class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_class = mrb_vm_const_get(mrb, mrb_intern_lit(mrb,<span class="hljs-string">"SomeClass"</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>create new instance of ruby class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_class_new = mrb_instance_new(mrb, ruby_class);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>invoke method on instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mrb_value ruby_class_value = mrb_funcall(mrb, ruby_class_new, <span class="hljs-string">"value"</span>, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>convert and print value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ruby_class_value: %s\n"</span>, RSTRING_PTR(ruby_class_value));

}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
